<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sudarshana AI - Image Generator</title>
<style>
body {
  background: black;
  color: #d1b3ff;
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
}
h1 {
  font-size: 2.2em;
  margin-bottom: 15px;
  color: #b366ff;
}
input {
  width: 90%;
  padding: 15px;
  margin: 15px 0;
  border: none;
  border-radius: 10px;
  font-size: 18px;
  background: #2b0033;
  color: white;
  outline: none;
}
button {
  background: linear-gradient(90deg, #7a00cc, #b84dff);
  border: none;
  padding: 18px 30px;
  border-radius: 12px;
  color: white;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
button.anim {
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
/* Toggle Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
  margin-bottom: 15px;
}
.switch input { display: none; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #555;
  transition: .4s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 26px; width: 26px;
  left: 4px; bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #b366ff;
}
input:checked + .slider:before {
  transform: translateX(26px);
}
.toggle-label {
  margin-left: 10px;
  font-size: 16px;
}
.images {
  margin-top: 20px;
}
.images img {
  width: 90%;
  max-width: 400px;
  margin: 10px;
  border-radius: 15px;
  box-shadow: 0 0 20px #8000ff;
}
/* Frontend Console */
.console {
  background: #1a001a;
  color: #d1b3ff;
  padding: 10px;
  border-radius: 10px;
  margin-top: 20px;
  font-family: monospace;
  font-size: 14px;
  max-height: 200px;
  overflow-y: auto;
  text-align: left;
}
</style>
</head>
<body>

<h1>⚡ Sudarshana AI</h1>

<label class="switch">
  <input type="checkbox" id="imageToggle">
  <span class="slider"></span>
</label>
<span class="toggle-label" id="toggleText">1 Image</span>

<br>
<input type="text" id="prompt" placeholder="Enter your prompt...">
<br>
<button id="generateBtn">⚡ Generate</button>

<div class="images" id="images"></div>
<div class="console" id="console"></div>

<script>
const API_KEY = "ddc-a4f-c964629239ac4b1eba7b5a8a57e94a38";
const API_URL = "https://api.a4f.co/v1/images/generations";

const generateBtn = document.getElementById("generateBtn");
const imagesDiv = document.getElementById("images");
const toggle = document.getElementById("imageToggle");
const toggleText = document.getElementById("toggleText");
const consoleDiv = document.getElementById("console");

toggle.addEventListener("change", () => {
  toggleText.textContent = toggle.checked ? "2 Images" : "1 Image";
});

function logConsole(msg) {
  const now = new Date();
  const time = now.toLocaleTimeString();
  consoleDiv.innerHTML += `[${time}] ${msg}<br>`;
  consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

async function generateImage(prompt, n) {
  generateBtn.disabled = true;
  generateBtn.classList.add("anim");
  generateBtn.textContent = "⚡ Generating...";
  imagesDiv.innerHTML = "";

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        model: "provider-4/imagen-3",
        prompt: prompt,
        n: n,
        response_format: "url",
        size: "1024x1024"
      })
    });

    const data = await response.json();
    logConsole(`Response: ${JSON.stringify(data)}`);

    // Queue scenario → rate limit per min or per day
    if (data.error && data.error.type === "rate_limit_error") {
      if (data.error.code === "rate_limit_rpm_exceeded" || data.error.code === "rate_limit_rpd_exceeded") {
        generateBtn.textContent = "⏳ In Queue...";
        setTimeout(() => generateImage(prompt, n), 15000); // retry unlimited
        return;
      }
    }

    // Try Different Prompt scenario → empty data or no URL after 2 sec
    if (!data.data || data.data.length === 0 || !data.data[0]?.url) {
      setTimeout(() => {
        if (!data.data || data.data.length === 0 || !data.data[0]?.url) {
          generateBtn.textContent = "Try Different Prompt";
          generateBtn.disabled = false;
          generateBtn.classList.remove("anim");
        }
      }, 2000);
      return;
    }

    // If URL exists → display images
    if (data.data && data.data.length > 0 && data.data[0].url) {
      imagesDiv.innerHTML = "";
      data.data.forEach(imgObj => {
        imagesDiv.innerHTML += `<img src="${imgObj.url}" alt="Generated Image">`;
      });
      generateBtn.textContent = "⚡ Generate";
      generateBtn.disabled = false;
      generateBtn.classList.remove("anim");
    }

  } catch (error) {
    logConsole(`Error: ${error}`);
    generateBtn.textContent = "❌ Error, Try Again";
    generateBtn.disabled = false;
    generateBtn.classList.remove("anim");
  }
}

generateBtn.addEventListener("click", () => {
  const prompt = document.getElementById("prompt").value.trim();
  if (!prompt) {
    alert("Please enter a prompt!");
    return;
  }
  const n = toggle.checked ? 2 : 1;
  generateImage(prompt, n);
});
</script>

</body>
</html>
